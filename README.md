# Forge Token Price Subgraph

Subgraph for Forge token OHLCV data on Evmos network.

## Entities

The subgraph defines the following entities:

- Pool
- Swap
- Candle
- LastCandle

## Pool

Each Pool entity is recorded with the following properties:

- id
- token0
- token1
- tickSpacing
- fee
- blockNumber
- blockTimestamp
- transactionHash

### Sample Query

```graphql
{
  pool(id: "0x1f98431c8ad98523631ae4a59f267346ea31f984") {
    id
    token0
    token1
    tickSpacing
    fee
    blockNumber
    blockTimestamp
    transactionHash
  }
}
```


## Swap

Each swap event is recorded with the following properties:

- id
- pool
- token0
- token1
- amount0
- amount1
- blockNumber
- blockTimestamp
- transactionHash

## Candle

Each Candle entity represents a candle for a specific token pair and duration with the following properties:

- id
- token0
- token1
- duration
- timestamp
- open
- close
- low
- high

## LastCandle

Each LastCandle entity represents the last candle for a specific token pair and duration with the following properties:

- id
- token0
- token1
- duration
- timestamp
- open
- close
- low
- high

## Candles


Candles are entities that represent the price movement of a specific token pair over a certain duration. Each candle has the following properties:

- `id`: A unique identifier for each Candle entity. It is generated by concatenating the `token0`, `token1`, and `duration` properties.
- `token0`: The address of the first token in the pair.
- `token1`: The address of the second token in the pair.
- `duration`: The duration of the candle in seconds.
- `timestamp`: The timestamp at which the candle starts.
- `open`: The opening price of the candle.
- `close`: The closing price of the candle.
- `low`: The lowest price during the candle duration.
- `high`: The highest price during the candle duration.


The `id` of a Candle is unique even if the token pairs and duration are the same. This is ensured by concatenating the `token0`, `token1`, and `duration` properties.

Here is an example of how a Candle's `id` is generated:

```typescript
const candleId = swap.token0.concat(swap.token1).concatI32(duration);
```

In this example, `swap.token0`, `swap.token1`, and `duration` are concatenated to form a unique `id` for each Candle.


### Querying Candles: Examples

- Query for candles within a specific timestamp range (Note: Forge deployed on block 12367456, first timestamp available is 1685206800)

```graphql
{
    candles(where: {duration: 1800, timestamp_gte: 1683082800, timestamp_lte: 1683169200}) {
        id
        timestamp
        open
        close
        low
        high
        token0
        token1
    }
}
```

- Query for candles with a specific duration and within a specific timestamp range for a specific token pair (5min candlesticks)

```graphql
{
    candles(where: {duration: 300, timestamp_gte: 1683082800, timestamp_lte: 1683169200, token0: "0xToken0Address", token1: "0xToken1Address"}) {
        id
        timestamp
        open
        close
        low
        high
        token0
        token1
    }
}

```





## Getting Started

To deploy the subgraph, follow these steps:

1. Clone the repository
2. Install dependencies with `yarn install`
3. Generate code with `yarn codegen`
4. Build the subgraph with `yarn build`
5. Deploy the subgraph with `DEPLOY_KEY=XXX yarn deploy`
